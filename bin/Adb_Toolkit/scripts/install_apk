#!/bin/bash

  adb start-server
  adb devices>/tmp/devices.txt
  sed -i '1d' /tmp/devices.txt
  dl=$(sed 's/\device//g' /tmp/devices.txt)
  device=$(zenity --list --text="Choose a device" --column="Devices" $dl )

if  [ "$?" -eq 1 ]; then

  zenity --error --text="Operation cancelled" --title="Aborted"
    exit 1

    elif [ "$device" == "" ]; then
      zenity --error --text="No device selected \n\n Aborting operation" --title="Aborted"
      exit 1

      else
apk=$(zenity \
    --file-selection --file-filter="Apk | *.apk" \
)

    if [ "$apk" != "" ]
        then
       (
    echo "10" ; sleep 1
    echo "# Detecting Device" ; sleep 1
    adb wait-for-device
    echo "20" ; sleep 1
    echo "# Device detected" ; sleep 1
    echo "50" ; sleep 1
    echo "# installing selected app" ; sleep 1
    adb -s $device install $apk 
    echo "# Finishing up"
    echo "70" ; sleep 4
    echo "# Done"
    echo "100" 
   
        
) | zenity --progress \
  --title="Apk install" \
  --text="Test" \
  --percentage=0 \
  clear
    else
    zenity --error --text="Please select a valid file" --title="Error"
    fi 
    fi